.PHONY: all install clean test

CFLAGS += -O2 -finline-functions -fomit-frame-pointer -fno-strict-aliasing --param max-inline-insns-single=1800 --param inline-unit-growth=500 --param large-function-growth=900 -Wmissing-prototypes -Wall -std=c99

OBJS = aes memory utils
LIB_NAME = libsayama
LIB = $(StaticCLibrary $(LIB_NAME), $(OBJS))
DYLIB = $(DynamicCLibrary $(LIB_NAME), $(OBJS))

# Test
CFLAGS += -I/usr/local/include/cutter
LDFLAGS += -lcutter
CUTTER = cutter
TEST_OBJS = test_aes test_memory test_word
TEST_LIB_NAME = test_sayama
TEST_LIB = $(DynamicCLibrary $(TEST_LIB_NAME), $(OBJS) $(TEST_OBJS))

all: $(LIB) $(DYLIB)

clean:
	rm -rf *.o $(LIB_NAME).* $(TEST_LIB_NAME).*

test: $(TEST_LIB)
	$(CUTTER) .

.DEFAULT: all

